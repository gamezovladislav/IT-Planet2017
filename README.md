# IT-Планета 2016/17. Программирование JAVA. Финал

## История

За последнее время абонентская база оператора IT-Planet Mobile сильно выросла и текущий модуль выставления счетов перестал справляться 
со своей задачей. В связи с этим, руководство IT-Planet Mobile просит участников реализовать для них новый модуль,  который справится 
с возросшей нагрузкой.

## Задача

Реализовать модуль формирования счетов для абонентов. _Счётом абонента_ будем называть сумму, которую он должен заплатить оператору. 

## Входные данные

Исходными данными для программы являются 3 файла:

1. Файл с описанием действующей тарифной линейки оператора.
2. Файл с абонентской базой оператора.
3. Файл с действиями абонентов (звонки, SMS, интернет).

Передача программе путей к файлам происходит через указание их в качестве следующих аргументов запуска:

```
-t,--tariffs <file>       Тарифная линейка
-s,--subscribers <file>   Абонентская база
-a,--actions <file>       Действия абонентов
```

### Тарифная линейка

Файл _XML_ формата в кодировке _UTF-8_ и следующего шаблона

```xml
<?xml version="1.0" encoding="UTF-8"?>
<tariffs>
  <tariff id="ID" name="TARIFF_NAME">
    <prices>
      <abonentFee value="ABONENT_FEE"/>
      <sms value="SMS_PRICE"/>
      <call value="CALL_PRICE" />
      <internet value="INT_PRICE" uom="INT_UOM"/>
    </prices>
    <packets>
      <sms value="SMS_PACK"/>
      <call value="CALL_PACK" />
      <internet value="INT_PACK" uom="INT_UOM"/>
    </packets>
  </tariff>
  ...
</tariffs>
```
где

* ID — идентификатор тарифа. (строка, длина &le; 100)
* TARIFF_NAME — название тарифа
* ABONENT_FEE — абонентская плата в рублях. (точность 2 десятичных знака, &le; 1000)
* SMS_PRICE — стоимость одной SMS сверх пакета. (точность 2 десятичных знака, &le; 100)
* CALL_PRICE — стоимость одной минуты разговора сверх пакета. (точность 2 десятичных знака, &le; 100)
* INT_PRICE — стоимость единицы интернет трафика сверх пакета. (точность 2 десятичных знака, &le; 100)
* INT_UOM — единица интернет трафика. (`kb`, `mb` или `gb`)
* SMS_PACK — размер пакета sms. (целое число, &le; 10<sup>6</sup>)
* CALL_PACK — размер пакета звонков в минутах. (целое число, &le; 10<sup>6</sup>)
* INT_PACK — размер пакета интернет трафика. (целое число, &le; 10<sup>6</sup>)

Например:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<tariffs>
  <tariff id="1" name="Вся Планета">
    <prices>
      <abonentFee value="100.00"/>
      <sms value="1.00"/>
      <call value="1.50" />
      <internet value="3.00" uom="mb"/>
    </prices>
    <packets>
      <sms value="100"/>
      <call value="400" />
      <internet value="3" uom="gb"/>
    </packets>
  </tariff>
</tariffs>
```

### Абонентская база

Файл _XML_ формата в кодировке _UTF-8_ и следующего шаблона

```xml
<?xml version="1.0" encoding="UTF-8"?>
<subsrubers>
  <subscriber msisdn="MSISDN" tariff="TARIFF_ID"/>
  ...
</subsrubers>
```
где

* MSISDN — идентификатор абонента. (строка из цифр, длина = 11)
* TARIFF_ID — идентификатор тарифа.

Например:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<subsrubers>
  <subscriber msisdn="79011234567" tariff="1"/>
</subsrubers>
```

### Действия абонентов

_ZIP_ архив. Внутри архива файл _XML_ формата с именем `actions.xml` в кодировке _UTF-8_ и следующего шаблона

```xml
<?xml version="1.0" encoding="UTF-8"?>
<actions>
  <action msisdn="MSISDN" 
          type="TYPE" 
          call_start="CALL_START" 
          call_end="CALL_END"
          int_size="INT_SIZE"/>
  ...
</actions>
```
где

* MSISDN — идентификатор абонента. (строка из цифр, длина = 11)
* TYPE — тип действия абонента. (`sms`, `call`, или `internet`)
* CALL_START — дата начала звонка. (строка формата `YYYY-MM-DDThh:mm:ss.SSS±hh:mm`)
* CALL_END — дата окончания звонка. (строка формата `YYYY-MM-DDThh:mm:ss.SSS±hh:mm`)
* INT_SIZE — размер трафика интернет сессии в байтах. (целое число, &le; 2<sup>30</sup>)

Например:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<actions>
  <action msisdn="79011234567" type="sms"/>
  <action msisdn="79011234567" type="call" start="2017-06-01T19:20:02.000+03:00" end="2017-06-01T19:20:22.000+03:00"/>
  <action msisdn="79011234567" type="internet" size="1234567"/>
</actions>
```

## Результат

В результате работы программы должен быть создан файл со счётом каждого абонента. 
Передача программе адреса файла происходит путём указания его в качестве аргумента запуска:

```
-i,--invoices <file>      Файл со счетами абонентов
```

Файл _JSON_ формата в кодировке _UTF-8_ и следующего шаблона

```json
{
  "invoices": [
    { "msisdn": "MSISDN", "value": "VALUE" },
    ...
  ]
}
```
где

* MSISDN — идентификатор абонента. (строка из цифр, длина = 11)
* VALUE — счёт в рублях. (точность 2 десятичных знака с округлением в большую сторону)

Например:

```json
{
  "invoices": [
    { "msisdn": "79011234567", "value": "1000.00" }
  ]
}
```

## Исключительные ситуации

1. Если любой из файлов с исходными данными отсутствует, программа должна завершиться выбросив исключение типа `RuntimeException`.

2. Если в данных тарифной линейки у какого-то тарифа отсутствует один из параметров, программа должна завершиться выбросив исключение типа
`RuntimeException` с сообщением формата `Tariff with id {} incorrect`. Если параметр задан, то его значение заведомо можно считать корректным.

3. Если в данных абонентской базы у какого-то абонента некорректный MSISDN или указан несуществующий тариф, программа должна завершиться 
выбросив исключение типа `RuntimeException` с сообщением формата `Subscriber with msisdn {} incorrect`.

3. Во всех остальных случаях можно считать, что исходные данные корректны.

## Важно

1. Все тарифы IT-Planet Mobile имеют посекундную тарификацию звонков.
2. Все тарифы IT-Planet Mobile имеют покилобайтную тарификацию интернет трафика.
3. Стоимость каждого действия абонента не округляется до суммы в физическом выражении. Округление должно быть произведено непосредствено
перед выставлением счёта абоненту.

## Критерии оценки программы

Критерии в порядке убывания значимости 

1. Корректность результатов
2. Производительность (время работы, используемая память)
3. Тестовое покрытие
4. Исходный код
5. История Git репозитория